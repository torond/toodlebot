<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://npmcdn.com/flatpickr/dist/themes/airbnb.css">
    <style>
        :root {
            --custom-width-full: 100%;
            --custom-width-day: calc(var(--custom-width-full) / 7);
            place-items: center;
        }

        .custom-btn-holder {
            display: flex;
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
        }

        .custom-btn-holder button {
            flex-grow: 1;
        }

        .flatpickr-calendar {
            width: var(--custom-width-full);
        }

        .dayContainer {
            width: var(--custom-width-full);
            max-width: var(--custom-width-full);
            min-width: var(--custom-width-full);
        }

        .flatpickr-days {
            width: var(--custom-width-full);
        }

        .flatpickr-day {
            max-width: var(--custom-width-day);
        }
    </style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<div class="picker" id="pkr"></div>
<p>{{config.description}}</p>

{{#data.numberOfParticipants}}
    <p>data.numberOfParticipants participants so far.</p>
{{/data.numberOfParticipants}}

<div class="custom-btn-holder">
    <button type="button">Cancel</button>
    {{#config.hasConfirmButton}}
        <button id="confirm-button" type="button">Confirm</button>
    {{/config.hasConfirmButton}}
</div>

<script>
    const fp = flatpickr("#pkr", {
        inline: true,
        disableMobile: "true",
        static: true, //necessary?
        mode: "multiple",
        {{#data.pickedDates}}defaultDate: data.pickedDates,{{/data.pickedDates}}
        {{#data.pickableDates}}enable: data.pickableDates,{{/data.pickableDates}}
    });

    function formatDate(date) {
        return date.getFullYear() + '-'
                + ('0' + date.getMonth()).slice(-2) + '-'
                + ('0' + date.getDate()).slice(-2)
    }

    xhr = new XMLHttpRequest();
    xhr.open('POST', '{{config.confirmRecipientUrl}}');
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.onload = function () {
        if (xhr.status !== 200) {
            alert('Request failed. Returned status of ' + xhr.status);
        }
    };
    document.getElementById("confirm-button").addEventListener("click",
            function () {
                xhr.send(JSON.stringify(fp.selectedDates.map(x => formatDate(x))))
            },
            false
    );
</script>
</body>
</html>
